<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Website</title>
    <style>
        /* Global Styles */
        body { 
            margin: 0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f5f7fa; 
            color: #333;
        }
        
        /* Navbar Styles */
        .navbar {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            background: #ffffff; 
            padding: 0.75rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar-logo { 
            font-size: 1.5rem; 
            font-weight: bold; 
            text-decoration: none; 
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 1.8rem;
            color: #3498db;
        }
        
        .navbar-menu { 
            list-style: none; 
            display: flex; 
            gap: 1.5rem; 
            margin: 0;
            padding: 0;
        }
        
        .navbar-menu a { 
            text-decoration: none; 
            color: #555;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }
        
        .navbar-menu a:hover { 
            color: #3498db;
            background: #f1f9fe;
        }
        
        .menu-toggle { 
            font-size: 1.8rem; 
            cursor: pointer; 
            background: none; 
            border: none; 
            display: none;
            color: #2c3e50;
        }
        
        .mobile-menu { 
            display: none; 
            flex-direction: column; 
            background: #fff; 
            border-top: 1px solid #eee;
            padding: 0.5rem 1rem; 
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .mobile-menu a { 
            padding: 0.7rem 0; 
            text-decoration: none; 
            color: #333;
            border-bottom: 1px solid #eee;
            font-weight: 500;
        }
        
        .mobile-menu a:last-child {
            border-bottom: none;
        }
        
        iframe { 
            width: 100%; 
            height: calc(100vh - 70px); 
            border: none;
            background: #f5f7fa;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .navbar-menu { display: none; }
            .menu-toggle { display: block; }
        }
        
        /* Loading Animation */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="#" class="navbar-logo">
            <span class="logo-icon"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRIzRnIppQiLHaWhut4IWH6oxz8AzBMXXmTXMs9aXheXkneRB1XqbhLW1PG&s=10" style="height:40px; width:40px; border-radius:50px;" alt="RN-News"</span>
            <span>Rose News</span>
        </a>
        <ul class="navbar-menu" id="desktopMenu">
            <li><a href="#" onclick="loadPage('home.html')">হোম</a></li>
            <li><a href="#" onclick="loadPage('about.html')">আমাদের সম্পর্কে</a></li>
            <li><a href="#" onclick="loadPage('services.html')">সেবা</a></li>
            <li><a href="#" onclick="loadPage('contact.html')">যোগাযোগ</a></li>
            <li id="loginMenu"><a href="#" onclick="loadPage('login.html')">লগইন</a></li>
        </ul>
        <button class="menu-toggle" onclick="toggleMobileMenu()">☰</button>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="#" onclick="loadPage('home.html', true)">হোম</a>
        <a href="#" onclick="loadPage('about.html', true)">আমাদের সম্পর্কে</a>
        <a href="#" onclick="loadPage('services.html', true)">সেবা</a>
        <a href="#" onclick="loadPage('contact.html', true)">যোগাযোগ</a>
        <a id="mobileLoginMenu" href="#" onclick="loadPage('login.html', true)">লগইন</a>
    </div>

    <!-- Content Frame -->
    <iframe id="contentFrame" src="home.html"></iframe>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { app } from './firebase-config.js';

        const auth = getAuth(app);
        const contentFrame = document.getElementById('contentFrame');
        const loader = document.getElementById('loader');

        // Loader control functions
        const showLoader = () => {
            loader.style.display = 'flex';
            // Set timeout to hide loader if page takes too long
            setTimeout(hideLoader, 10000); // 10 seconds timeout
        };
        
        const hideLoader = () => {
            loader.style.display = 'none';
        };

        // Make functions available globally
        window.showLoader = showLoader;
        window.hideLoader = hideLoader;

        // Handle iframe loading
        contentFrame.addEventListener('load', hideLoader);
        contentFrame.addEventListener('error', () => {
            hideLoader();
            alert('পৃষ্ঠা লোড করতে সমস্যা হয়েছে!');
        });

        // Load page in iframe
        window.loadPage = function(page, closeMenu = false) {
            showLoader();
            contentFrame.src = page;
            if (closeMenu) {
                document.getElementById('mobileMenu').style.display = 'none';
            }
        }

        // Toggle mobile menu
        window.toggleMobileMenu = function() {
            const menu = document.getElementById('mobileMenu');
            menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
        }

        // Initialize loader for first page load
        showLoader();
        contentFrame.onload = hideLoader;

        // Auth state change listener
        onAuthStateChanged(auth, (user) => {
            const desktopMenu = document.getElementById('desktopMenu');
            const mobileMenu = document.getElementById('mobileMenu');
            const loginMenu = document.getElementById('loginMenu');
            const mobileLoginMenu = document.getElementById('mobileLoginMenu');

            // Clear login/signup options first
            loginMenu.innerHTML = `<a href="#" onclick="loadPage('login.html')">লগইন</a>`;
            mobileLoginMenu.innerHTML = `<a href="#" onclick="loadPage('login.html', true)">লগইন</a>`;

            // Remove extra menu if already exists
            document.querySelectorAll(".dynamicMenu").forEach(el => el.remove());

            if (user) {
                // If logged in
                loginMenu.innerHTML = `<a href="#" onclick="logoutUser()">লগআউট</a>`;
                mobileLoginMenu.innerHTML = `<a href="#" onclick="logoutUser()">লগআউট</a>`;

                // Add Post menu for all users
                const postMenu = document.createElement('li');
                postMenu.classList.add("dynamicMenu");
                postMenu.innerHTML = `<a href="#" onclick="loadPage('post.html')">পোস্ট</a>`;
                desktopMenu.appendChild(postMenu);

                const postMenuMobile = document.createElement('a');
                postMenuMobile.classList.add("dynamicMenu");
                postMenuMobile.href = "#";
                postMenuMobile.onclick = () => loadPage('post.html', true);
                postMenuMobile.textContent = "পোস্ট";
                mobileMenu.appendChild(postMenuMobile);

                // Add Profile menu
                const profileMenu = document.createElement('li');
                profileMenu.classList.add("dynamicMenu");
                profileMenu.innerHTML = `<a href="#" onclick="loadPage('profile.html')">প্রোফাইল</a>`;
                desktopMenu.insertBefore(profileMenu, loginMenu);

                const profileMenuMobile = document.createElement('a');
                profileMenuMobile.classList.add("dynamicMenu");
                profileMenuMobile.href = "#";
                profileMenuMobile.onclick = () => loadPage('profile.html', true);
                profileMenuMobile.textContent = "প্রোফাইল";
                mobileMenu.insertBefore(profileMenuMobile, mobileLoginMenu);

                // If admin
                if (user.email === "admincontrol@gmail.com") {
                    const adminMenu = document.createElement('li');
                    adminMenu.classList.add("dynamicMenu");
                    adminMenu.innerHTML = `<a href="#" onclick="loadPage('admin.html')">অ্যাডমিন</a>`;
                    desktopMenu.insertBefore(adminMenu, loginMenu);

                    const adminMenuMobile = document.createElement('a');
                    adminMenuMobile.classList.add("dynamicMenu");
                    adminMenuMobile.href = "#";
                    adminMenuMobile.onclick = () => loadPage('admin.html', true);
                    adminMenuMobile.textContent = "অ্যাডমিন";
                    mobileMenu.insertBefore(adminMenuMobile, mobileLoginMenu);
                }
            }
        });

        // Logout function
        window.logoutUser = function() {
            if (confirm('আপনি কি লগআউট করতে চান?')) {
                signOut(auth).then(() => {
                    alert("সফলভাবে লগআউট হয়েছে!");
                    loadPage('home.html');
                }).catch((error) => {
                    alert("লগআউট করতে সমস্যা: " + error.message);
                });
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('mobileMenu');
            const toggleBtn = document.querySelector('.menu-toggle');
            
            if (menu.style.display === 'flex' && 
                !menu.contains(event.target) && 
                !toggleBtn.contains(event.target)) {
                menu.style.display = 'none';
            }
        });

        // Handle initial page load
        window.addEventListener('DOMContentLoaded', () => {
            // Additional initialization if needed
        });
    </script>
</body>
</html>