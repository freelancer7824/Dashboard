<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>নতুন পোস্ট</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        textarea { min-height: 200px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { color: red; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>নতুন পোস্ট তৈরি করুন</h1>
        <div class="form-group">
            <label for="postTitle">শিরোনাম</label>
            <input type="text" id="postTitle" required>
        </div>
        <div class="form-group">
            <label for="postContent">বিস্তারিত</label>
            <textarea id="postContent" required></textarea>
        </div>
        <div class="form-group">
            <label for="postCategory">ক্যাটাগরি</label>
            <select id="postCategory">
                <option value="general">সাধারণ</option>
                <option value="technology">প্রযুক্তি</option>
                <option value="education">শিক্ষা</option>
            </select>
        </div>
        <div class="form-group">
            <label for="postImage">ইমেজ URL (ঐচ্ছিক)</label>
            <input type="text" id="postImage">
        </div>
        <div id="postError" class="error"></div>
        <button onclick="submitPost()">পোস্ট করুন</button>
    </div>

    <script type="module">
        import { getAuth } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
        import { app } from './firebase-config.js';

        const auth = getAuth(app);
        const db = getDatabase(app);

        window.submitPost = async function() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const category = document.getElementById('postCategory').value;
            const image = document.getElementById('postImage').value;
            const errorElement = document.getElementById('postError');
            
            if (!title || !content) {
                errorElement.textContent = "শিরোনাম এবং বিস্তারিত আবশ্যক!";
                return;
            }
            
            const user = auth.currentUser;
            if (!user) {
                errorElement.textContent = "লগইন করা প্রয়োজন!";
                return;
            }
            
            try {
                const newPostRef = push(ref(db, 'posts'));
                await set(newPostRef, {
                    title,
                    content,
                    category,
                    image: image || null,
                    author: user.email,
                    timestamp: Date.now()
                });
                
                alert("পোস্ট সফলভাবে তৈরি হয়েছে!");
                window.parent.loadPage('home.html');
            } catch (error) {
                errorElement.textContent = error.message;
            }
        };
    </script>
</body>
</html>