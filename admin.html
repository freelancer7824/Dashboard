<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অ্যাডমিন প্যানেল</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .admin-container { max-width: 1200px; margin: 0 auto; }
        .admin-header { text-align: center; margin-bottom: 30px; }
        .admin-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .admin-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
        .card-value { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        .card-label { color: #666; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f2f2f2; }
        tr:hover { background: #f9f9f9; }
        .btn { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>অ্যাডমিন কন্ট্রোল প্যানেল</h1>
        </div>
        
        <div class="admin-cards">
            <div class="admin-card">
                <div class="card-label">মোট পোস্ট</div>
                <div class="card-value" id="totalPosts">0</div>
            </div>
            <div class="admin-card">
                <div class="card-label">মোট ব্যবহারকারী</div>
                <div class="card-value" id="totalUsers">0</div>
            </div>
        </div>
        
        <h2>সাম্প্রতিক পোস্ট</h2>
        <table>
            <thead>
                <tr>
                    <th>শিরোনাম</th>
                    <th>লেখক</th>
                    <th>তারিখ</th>
                    <th>কার্যক্রম</th>
                </tr>
            </thead>
            <tbody id="recentPosts">
                <!-- Recent posts will be loaded here -->
            </tbody>
        </table>
    </div>

    <script type="module">
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
        import { app } from './firebase-config.js';

        const db = getDatabase(app);

        function loadAdminData() {
            // Load total posts count
            const postsRef = ref(db, 'posts');
            onValue(postsRef, (snapshot) => {
                const posts = snapshot.val();
                document.getElementById('totalPosts').textContent = posts ? Object.keys(posts).length : 0;
                
                // Load recent posts
                const recentPostsTable = document.getElementById('recentPosts');
                recentPostsTable.innerHTML = '';
                
                if (posts) {
                    // Get last 5 posts
                    const recentPosts = Object.entries(posts)
                        .sort((a, b) => b[1].timestamp - a[1].timestamp)
                        .slice(0, 5);
                    
                    recentPosts.forEach(([id, post]) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${post.title}</td>
                            <td>${post.author}</td>
                            <td>${new Date(post.timestamp).toLocaleDateString()}</td>
                            <td><button class="btn btn-danger" onclick="deletePost('${id}')">ডিলিট</button></td>
                        `;
                        recentPostsTable.appendChild(row);
                    });
                }
            });
            
            // In a real app, you would also load users count from your users collection
            document.getElementById('totalUsers').textContent = "N/A";
        }

        window.deletePost = async function(postId) {
            if (confirm("আপনি কি এই পোস্ট ডিলিট করতে চান?")) {
                try {
                    await remove(ref(db, `posts/${postId}`));
                    alert("পোস্ট সফলভাবে ডিলিট হয়েছে!");
                } catch (error) {
                    alert("ডিলিট করতে সমস্যা হয়েছে: " + error.message);
                }
            }
        };

        loadAdminData();
    </script>
</body>
</html>